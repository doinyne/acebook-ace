<p id="notice"><%= notice %></p>
<div class="card container mb-5 p-5">
<p>
  <%if @post_image.user.image.attached?%>
  <%=image_tag(@post_image.user.image, height: '100', width: '100')%>
  <%else%>
  <%=image_tag "profile pic.png", :class => "profile"%>
  <%end%>
</p>

<p>
  <%= @post_image.user.email %>
</p> 
  <% if @post_image.image.attached? %>
    <%= image_tag @post_image.image %>
  <% end %>
  <div class="row">
    <div class="card-body">
      <h5 class="card-title"><%= @post_image.title %></h5>
      <p class="card-text"><%= @post_image.content %></p>
      <%= link_to 'Edit', edit_post_image_path(@post_image), :class => "card-link" %>  |
      <%= link_to 'Back', post_images_path, :class => "card-link" %>
    </div>
  </div>
</div>
</div>
<%# divider %>
<h2 class="h2 text-center">Comments</h2>
<% @post_image.comments.each do |comment| %>
  <div class="card container mb-5 p-5">
    <div class="card-body">
    <%if comment.user.image.attached?%>
    <%=image_tag(comment.user.image, height: '50', width: '50')%>
    <%else%>
    <%=image_tag "profile pic.png", :class => "profile"%>
    <%end%>
      <h5 class="card-title"><%= comment.user.email %></h5>
      <h6 class="card-subtitle mb-2 text-muted"><%= comment.created_at.strftime("%A %d %B %Y, %I:%M%p").freeze %> </h6>
      <p class="card-text"><%= comment.body %></p>
      

      <% if comment.user == Current.user %>
  
      <%= link_to 'Destroy Comment', [comment.post_image, comment],
              method: :delete,
              data: { confirm: "Are you sure?" } %>

              <%= button_to 'Like', post_image_likes_path(comment), method: :post_image %>
              
<% end %>

          <%
=begin%>
 <% pre_like = comment.likes.find { |like| like.user_id == Current.user.id} %>
          <% if pre_like %>
            <%= button_to 'Unlike', post_image_like_path(post_image, pre_like), method: :delete %>
          <% else %>
            <%= button_to 'Like', post_image_likes_path(post_image), method: :post_image %>
          <% end %>
          <p id="like-count"><%= post_image.likes.count%><%= (post_image.likes.count) == 1 ? 'Like' : 'Likes' %></p> 
<%
=end%>

  </div>
</div>
<% end %>
<%# divider %>
<h2 class="h2 text-center">Add a comment</h2>
<div class="container">
  <%= form_with model: [ @post_image, @post_image.comments.build ] do |form| %>
    <%= form.label :commenter, :class => "form-label" %>
    <%= form.text_field :commenter, :class => "form-control" %>
    <%= form.label :body, :class => "form-label" %>
    <%= form.text_area :body, :class => "form-control" %><br>
    <%= form.submit  %>
  <% end %>
</div>
